<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=fr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Contrôler la tête de lecture avec MediaElement - MAUI, c'est clair !</title><meta name=author content="Jean-Emmanuel BAILLAT">
<meta name=author-link content="https://github.com/Kapusch"><meta name=description content="Continuons sur notre lancée avec l’implémentation du contrôle de la tête de lecture ! L’idée est de pouvoir se déplacer à un endroit précis du morceau."><meta name=keywords content='MVVM,Data Binding,MediaElement,Slider'><meta itemprop=name content="Contrôler la tête de lecture avec MediaElement"><meta itemprop=description content="Continuons sur notre lancée avec l’implémentation du contrôle de la tête de lecture ! L’idée est de pouvoir se déplacer à un endroit précis du morceau."><meta itemprop=datePublished content="2023-12-01T00:00:11+00:00"><meta itemprop=dateModified content="2023-12-01T00:00:11+00:00"><meta itemprop=wordCount content="2156"><meta itemprop=image content="https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/featured-image-preview-en.png"><meta itemprop=keywords content="MVVM,Data Binding,MediaElement,Slider,"><meta property="og:title" content="Contrôler la tête de lecture avec MediaElement"><meta property="og:description" content="Continuons sur notre lancée avec l’implémentation du contrôle de la tête de lecture ! L’idée est de pouvoir se déplacer à un endroit précis du morceau."><meta property="og:type" content="article"><meta property="og:url" content="https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/"><meta property="og:image" content="https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/featured-image-preview-en.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-01T00:00:11+00:00"><meta property="article:modified_time" content="2023-12-01T00:00:11+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/featured-image-preview-en.png"><meta name=twitter:title content="Contrôler la tête de lecture avec MediaElement"><meta name=twitter:description content="Continuons sur notre lancée avec l’implémentation du contrôle de la tête de lecture ! L’idée est de pouvoir se déplacer à un endroit précis du morceau."><meta name=twitter:site content="@kapuschinfo"><meta name=application-name content="MAUI, c'est clair !"><meta name=apple-mobile-web-app-title content="MAUI, c'est clair !"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical href=https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/><link rel=prev href=https://www.mauicestclair.fr/posts/tutos/my-first-app/10-play-music-with-mediaelement/><link rel=next href=https://www.mauicestclair.fr/posts/tutos/my-first-app/12-control-volume-with-mediaelement/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Contrôler la tête de lecture avec MediaElement","inLanguage":"fr","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.mauicestclair.fr\/posts\/tutos\/my-first-app\/11-control-playback-position-with-mediaelement\/"},"genre":"posts","keywords":"MVVM, Data Binding, MediaElement, Slider","wordcount":2156,"url":"https:\/\/www.mauicestclair.fr\/posts\/tutos\/my-first-app\/11-control-playback-position-with-mediaelement\/","datePublished":"2023-12-01T00:00:11+00:00","dateModified":"2023-12-01T00:00:11+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Jean-Emmanuel BAILLAT"},"description":"Continuons sur notre lancée avec l’implémentation du contrôle de la tête de lecture ! L’idée est de pouvoir se déplacer à un endroit précis du morceau."}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=left><div class=header-title><a href=/ title="MAUI, c'est clair !"><img loading=lazy src=/main_avatar.jpg srcset="/main_avatar.jpg, /main_avatar.jpg 1.5x, /main_avatar.jpg 2x" sizes=auto data-title="MAUI, c'est clair !" data-alt="MAUI, c'est clair !" class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>MAUI, c'est clair !</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class="menu-item has-children"><a class=menu-link href=/posts/><i class="fa-solid fa-newspaper fa-fw fa-sm" aria-hidden=true></i> Articles</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/posts/tutos/><i class="fa-solid fa-graduation-cap fa-fw fa-sm" aria-hidden=true></i> Cours</a></li><li class=menu-item><a class=menu-link href=/posts/tips/><i class="fa-solid fa-lightbulb fa-fw fa-sm" aria-hidden=true></i> Astuces</a></li></ul></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> À propos</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Rechercher des titres, des contenus..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Chercher><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Effacer><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Changer de Thème"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label="Choisir la langue" title="Choisir la langue"><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><span class="menu-link text-secondary" title=Français>Français</span></li><li class=menu-item><a href=/en/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/ class=menu-link title=English>English</a></li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="MAUI, c'est clair !"><img loading=lazy src=/main_avatar.jpg srcset="/main_avatar.jpg, /main_avatar.jpg 1.5x, /main_avatar.jpg 2x" sizes=auto data-title=/main_avatar.jpg data-alt=/main_avatar.jpg class=logo style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text>MAUI, c'est clair !</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Rechercher des titres, des contenus..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Chercher><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Effacer><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Annuler</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/posts/><i class="fa-solid fa-newspaper fa-fw fa-sm" aria-hidden=true></i> Articles</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/posts/tutos/><i class="fa-solid fa-graduation-cap fa-fw fa-sm" aria-hidden=true></i> Cours</a></li><li class=menu-item><a class=menu-link href=/posts/tips/><i class="fa-solid fa-lightbulb fa-fw fa-sm" aria-hidden=true></i> Astuces</a></li></ul></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> À propos</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Changer de Thème"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label="Choisir la langue" title="Choisir la langue">Français<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option value=/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/ selected disabled>Français</option><option value=/en/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/>English</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item><a href=/posts/ title=Publications>Publications</a></li><li class=breadcrumb-item><a href=/posts/tutos/ title=Cours>Cours</a></li><li class=breadcrumb-item><a href=/posts/tutos/my-first-app/ title="Ma première app">Ma première app</a></li><li class="breadcrumb-item active" aria-current=page>Contrôler la tête de lecture avec MediaElement</li></ol></nav><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>Contenus&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Contrôler la tête de lecture avec MediaElement</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/Kapusch target=_blank rel="external nofollow noopener noreferrer author" class=author><img loading=lazy src=/main_avatar.jpg srcset="/main_avatar.jpg, /main_avatar.jpg 1.5x, /main_avatar.jpg 2x" sizes=auto data-title="Jean-Emmanuel BAILLAT" data-alt="Jean-Emmanuel BAILLAT" class=avatar style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>&nbsp;Jean-Emmanuel BAILLAT</a></span></div><div class=post-meta-line><span title="publié le 2023-12-01 00:00:11"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=01/12/2023>01/12/2023</time></span>&nbsp;<span title="Mis à jour le 2023-12-01 00:00:11"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=01/12/2023>01/12/2023</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>2156 mots</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>11 minutes</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contenus</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#binding-des-composants>Binding des composants</a></li><li><a href=#contrôler-la-tête-de-lecture>Contrôler la tête de lecture</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Afin d’assurer le bon déroulement de cet article, je t’invite à repartir depuis <a href=../10-play-music-with-mediaelement/>ce chapitre</a> où l’on a configuré le <em>MediaElement</em>.</div></div></div>Dans l’article précédent, on avait découvert le <em><a href=https://learn.microsoft.com/fr-fr/dotnet/communitytoolkit/maui/views/mediaelement target=_blank rel="external nofollow noopener noreferrer">MediaElement<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></em> pour lire des fichiers audio, mais avec l’aide de nos propres contrôles. Tu te rappelles des <em>Sliders</em> qu’on avait mis en place ? Ils sont cools mais ils ne servent à rien ! 😄</p><p>Alors aujourd’hui, nous allons commencer par implémenter le contrôle de la tête de lecture, pour permettre à l’utilisateur de se déplacer à un endroit précis du morceau.</p><h2 id=binding-des-composants>Binding des composants</h2><p>Si tu te rappelles bien, dans le <a href=../7-music-player-display-time-tracker/>chapitre sur l’affichage du temps d’écoute</a>, nous avions introduit 3 composants :</p><ul><li><p><code>ElapsedTime</code> qui est un <em>Label</em> pour afficher le temps écoulé de lecture,</p></li><li><p><code>TotalTime</code> qui est aussi un <em>Label</em>, mais pour afficher la durée totale de la piste audio,</p></li><li><p>et enfin le <em>Slider</em> <code>TimeTracker</code>, pour contrôler la tête de lecture de la piste.</p></li></ul><p>Adieu les données factices ! Nous allons désormais donner vie à ces composants avec l’aide du <strong>Data Binding</strong>. Et on isolera tout ça dans une méthode d’initialisation <em>InitTimeTracker()</em> :</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=cp>#region</span> <span class=n>Time</span> <span class=n>Tracker</span> <span class=c1>// Repère bien la région pour ajouter le nouveau code</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>void</span> <span class=n>InitTimeTracker</span><span class=p>()</span> <span class=c1>// Voici la nouvelle méthode d&#39;initialisation</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>TimeTracker</span><span class=p>.</span><span class=n>Bind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Slider</span><span class=p>.</span><span class=n>ValueProperty</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>nameof</span><span class=p>(</span><span class=n>MusicPlayer</span><span class=p>.</span><span class=n>Position</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>source</span><span class=p>:</span> <span class=n>MusicPlayer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>convert</span><span class=p>:</span> <span class=p>(</span><span class=n>TimeSpan</span> <span class=n>currentPosition</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>currentPosition</span><span class=p>.</span><span class=n>TotalSeconds</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>TimeTracker</span><span class=p>.</span><span class=n>Bind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Slider</span><span class=p>.</span><span class=n>MaximumProperty</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>nameof</span><span class=p>(</span><span class=n>MusicPlayer</span><span class=p>.</span><span class=n>Duration</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>source</span><span class=p>:</span> <span class=n>MusicPlayer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>convert</span><span class=p>:</span> <span class=p>(</span><span class=n>TimeSpan</span> <span class=n>duration</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=n>duration</span><span class=p>.</span><span class=n>TotalSeconds</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ElapsedTime</span><span class=p>.</span><span class=n>Bind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Label</span><span class=p>.</span><span class=n>TextProperty</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>nameof</span><span class=p>(</span><span class=n>MusicPlayer</span><span class=p>.</span><span class=n>Position</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>source</span><span class=p>:</span> <span class=n>MusicPlayer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>stringFormat</span><span class=p>:</span> <span class=s>&#34;{0:mm\\:ss}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>TotalTime</span><span class=p>.</span><span class=n>Bind</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Label</span><span class=p>.</span><span class=n>TextProperty</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>nameof</span><span class=p>(</span><span class=n>MusicPlayer</span><span class=p>.</span><span class=n>Duration</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>source</span><span class=p>:</span> <span class=n>MusicPlayer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>stringFormat</span><span class=p>:</span> <span class=s>&#34;{0:mm\\:ss}&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>#endregion</span>
</span></span></code></pre></td></tr></table></div></div><p>Oui je sais c’est un peu dense, courage ! Tout est détaillé juste après.</p><p>Pour commencer, nous avons modifié le comportement du <code>TimeTracker</code> pour lui associer deux propriétés :</p><ul><li><p>la position actuelle du curseur sur le <em>Slider</em>,</p></li><li><p>et la valeur maximale du curseur (quand il est positionné tout à droite).</p></li></ul><p>Intéressons-nous maintenant d’un peu plus près au <em>MediaElement</em> incarné par notre composant <code>MusicPlayer</code>. Celui-ci expose justement ce qu’il nous faut :</p><ul><li><p>la position de la tête de lecture en temps réel (<code>MusicPlayer.Position</code>), à associer à la position du curseur sur le <em>Slider</em> (<code>TimeTracker.Value</code>),</p></li><li><p>et la durée totale du morceau (<code>MusicPlayer.Duration</code>), à associer à la valeur maximale du <em>Slider</em> (<code>TimeTracker.Maximum</code>).</p></li></ul><p>Enfin, si tu te rappelles bien, le <em>Slider</em> ne peut considérer que des valeurs de type <em>double</em>. C’est pourquoi nous avons besoin de convertir les valeurs obtenues avec <code>MusicPlayer.Position</code> et <code>MusicPlayer.Duration</code>, depuis le type <em>TimeSpan</em> vers le type <em>double</em>, avec la propriété <code>TotalSeconds</code>.</p><p><div class="details admonition comment open"><div class="details-summary admonition-title"><i class="icon fa-regular fa-comments fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>🐒‎ ‎ Et du coup, l’utilisateur pourra avancer ou reculer la lecture du morceau à la seconde près !</div></div></div>Tout juste ! 🙂 Voyons maintenant pour les <em>Labels</em>.</p><p>Pour le composant <code>ElapsedTime</code>, on veut qu’il affiche depuis combien de temps le morceau est joué en se basant lui aussi sur la propriété <code>MusicPlayer.Position</code>. Seulement, on ne veut pas afficher n’importe quoi ! On veut en effet afficher une durée en minutes et en secondes. Pour cela, on a besoin de lui appliquer le format de texte souhaité avec l’aide du code : <code>{0:mm\\:ss}</code>.</p><p>Pour le composant <code>TotalTime</code>, on veut afficher le temps total d’écoute du morceau en se basant sur la propriété <code>MusicPlayer.Duration</code>. Et de la même façon, on applique le même format de texte pour afficher une durée en minutes et en secondes.</p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-lightbulb fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Pour plus d’information, voir le <a href=https://learn.microsoft.com/fr-fr/dotnet/standard/base-types/custom-timespan-format-strings target=_blank rel="external nofollow noopener noreferrer">StringFormat<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a>.</div></div></div><p>Au fait, n’oublie pas de remplacer le signe “=>” par “=” à la déclaration de chacun de ces composants ! Sinon ça ne marchera pas puisque le même objet sera retourné à chaque appel à ces variables. On peut d’ailleurs en profiter aussi pour retirer les valeurs factices qu’on avait définies par défaut pour certaines propriétés :</p><ul><li><p><code>Text</code> pour les <em>Labels</em>,</p></li><li><p><code>Maximum</code> et <code>Value</code> pour le <em>Slider</em>.</p></li></ul><p>Et voici donc la déclaration actualisée pour ces 3 composants :</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=cp>#region</span> <span class=n>Time</span> <span class=n>Tracker</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Label</span> <span class=n>ElapsedTime</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Label</span> <span class=c1>// Le signe “=&gt;” a été remplacé par “=”</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FontSize</span> <span class=p>=</span> <span class=m>14</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TextColor</span> <span class=p>=</span> <span class=n>Colors</span><span class=p>.</span><span class=n>White</span>
</span></span><span class=line><span class=cl><span class=p>}.</span><span class=n>TextCenter</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Slider</span> <span class=n>TimeTracker</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Slider</span> <span class=c1>// Le signe “=&gt;” a été remplacé par “=”</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Minimum</span> <span class=p>=</span> <span class=m>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>MinimumTrackColor</span> <span class=p>=</span> <span class=n>Colors</span><span class=p>.</span><span class=n>LightSalmon</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>MaximumTrackColor</span> <span class=p>=</span> <span class=n>Colors</span><span class=p>.</span><span class=n>Black</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Label</span> <span class=n>TotalTime</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Label</span> <span class=c1>// Le signe “=&gt;” a été remplacé par “=”</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FontSize</span> <span class=p>=</span> <span class=m>14</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TextColor</span> <span class=p>=</span> <span class=n>Colors</span><span class=p>.</span><span class=n>White</span>
</span></span><span class=line><span class=cl><span class=p>}.</span><span class=n>TextCenter</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=cp>#endregion</span>
</span></span></code></pre></td></tr></table></div></div><p>Enfin, la méthode d’initialisation de ces composants devra être appelée depuis le constructeur de la page :</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>NightClub.Views</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>MusicPlayerView</span> <span class=p>:</span> <span class=n>ContentPage</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>MusicPlayerView</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>        <span class=n>InitTimeTracker</span><span class=p>();</span> <span class=c1>// Sans cela, rien ne marche !</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Allez vas-y, relances le projet ! Je suis sûr que tu en meurs d’envie 😄</p><p>Normalement, tu devrais voir les textes s’initialiser correctement en se basant sur de vraies valeurs. Également, le curseur devrait se déplacer tout seul selon la progression de la lecture du morceau.</p><p><div class="details admonition comment open"><div class="details-summary admonition-title"><i class="icon fa-regular fa-comments fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>🐒‎ ‎ Ah ouais ça marche ! Mais j’ai l’impression que l’interface bouge toute seule, y’a pas un bug avec notre <em>Grid</em> ?</div></div></div>Bon, c’est vrai, l’affichage est un peu saccadé !</p><p align=center><img max-width=100% max-height=100% src=./images/22C49091C491C43AE81103F1197859CE.gif></p><figure></figure><p>On peut s’amuser à colorer l’arrière-plan de nos <em>Labels</em> pour mieux se rendre compte de ce qu’il se passe :</p><p align=center><img max-width=100% max-height=100% src=./images/F4D5A7231779E8E2EE06E4736EF91D43.gif></p><figure><figcaption class=image-caption>En jouant avec les couleurs, on voit bien que le Label change de taille à chaque mise à jour de son texte.</figcaption></figure><p>Quand la lecture de la chanson progresse, le texte est actualisé à chaque seconde et une nouvelle valeur remplace l’ancienne. Seulement, on dirait que certaines valeurs nécessitent plus d’espace que d’autres ! 😄</p><p><div class="details admonition comment open"><div class="details-summary admonition-title"><i class="icon fa-regular fa-comments fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>🐒‎ ‎ Mais on n’avait pas défini des tailles fixes pour nos colonnes ?!</div></div></div>Eh si, tu as raison ! Il est possible qu’il s’agisse d’un bug, je n’ai pas trouvé de bonnes raisons qui expliqueraient ce comportement. Mais .NET MAUI n’existe que depuis l’an dernier, alors il lui fallait bien quelques petits défauts à ce framework ! Juste le temps que les ingénieurs de Microsoft les corrigent (ou même des contributeurs open-source !).</p><p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-lightbulb fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Après une mise à jour vers .NET 8, je n’ai plus reproduit ce bug.</div></div></div>Pas de panique, nous allons vite contourner ce problème ! Ça fait parti des aléas de la vie du développeur 🤓</p><p>Si tu te rappelles le <a href=../6-arrange-elements-on-a-page/>chapitre sur les fondations</a>, on y avait défini un composant <em>Grid</em> nommé <code>BottomLayout</code>, que l’on a divisé en 7 colonnes de tailles différentes :</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Grid</span> <span class=n>BottomLayout</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>Grid</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>ColumnDefinitions</span> <span class=p>=</span> <span class=n>Columns</span><span class=p>.</span><span class=n>Define</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>10</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>10</span><span class=p>),</span> <span class=c1>// Cette colonne contient le Label ElapsedTime</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>20</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>20</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>20</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>10</span><span class=p>),</span> <span class=c1>// Cette colonne contient le Label TotalTime</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>10</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p>On va retravailler la structure de notre <em>Grid</em> en fusionnant les deux premières colonnes, et les deux dernières…</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Grid</span> <span class=n>BottomLayout</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>Grid</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>ColumnDefinitions</span> <span class=p>=</span> <span class=n>Columns</span><span class=p>.</span><span class=n>Define</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>20</span><span class=p>),</span> <span class=c1>// On fusionne les deux premières colonnes...</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>20</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>20</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>20</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>Stars</span><span class=p>(</span><span class=m>20</span><span class=p>)),</span> <span class=c1>// ... et les deux dernières !</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p>… puis retravailler la disposition des éléments du <code>BottomLayout</code> :</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=n>Grid</span> <span class=n>BottomLayout</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=n>Grid</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>Children</span> <span class=p>=</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ElapsedTime</span><span class=p>.</span><span class=n>Row</span><span class=p>(</span><span class=m>0</span><span class=p>).</span><span class=n>Column</span><span class=p>(</span><span class=m>0</span><span class=p>).</span><span class=n>End</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>TimeTracker</span><span class=p>.</span><span class=n>Row</span><span class=p>(</span><span class=m>0</span><span class=p>).</span><span class=n>Column</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>ColumnSpan</span><span class=p>(</span><span class=m>3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>TotalTime</span><span class=p>.</span><span class=n>Row</span><span class=p>(</span><span class=m>0</span><span class=p>).</span><span class=n>Column</span><span class=p>(</span><span class=m>4</span><span class=p>).</span><span class=n>Start</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>RepeatOnceButton</span><span class=p>.</span><span class=n>Row</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>Column</span><span class=p>(</span><span class=m>0</span><span class=p>).</span><span class=n>End</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>MediaControlLayout</span><span class=p>.</span><span class=n>Row</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>Column</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>ColumnSpan</span><span class=p>(</span><span class=m>3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>DownloadButton</span><span class=p>.</span><span class=n>Row</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>Column</span><span class=p>(</span><span class=m>4</span><span class=p>).</span><span class=n>Start</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>MuteButton</span><span class=p>.</span><span class=n>Row</span><span class=p>(</span><span class=m>2</span><span class=p>).</span><span class=n>Column</span><span class=p>(</span><span class=m>0</span><span class=p>).</span><span class=n>End</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>VolumeTracker</span><span class=p>.</span><span class=n>Row</span><span class=p>(</span><span class=m>2</span><span class=p>).</span><span class=n>Column</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>ColumnSpan</span><span class=p>(</span><span class=m>3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p>Comme on a supprimé deux colonnes de notre <em>Grid</em> initiale, on a dû corriger le positionnement de nos composants sur la grille, en modifiant leur colonne assignée ainsi que leur alignement horizontal. Pour cela, nous avons eu recours aux méthodes <em><a href=https://learn.microsoft.com/fr-fr/dotnet/communitytoolkit/maui/markup/extensions/view-extensions#start target=_blank rel="external nofollow noopener noreferrer">Start()<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></em> et <em><a href=https://learn.microsoft.com/fr-fr/dotnet/communitytoolkit/maui/markup/extensions/view-extensions#end target=_blank rel="external nofollow noopener noreferrer">End()<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden=true></i></a></em>. Elles permettent respectivement d’aligner un composant horizontalement au début ou à la fin de l’espace qui lui est disponible.</p><p>Et voilà le travail :</p><p align=center><img max-width=100% max-height=100% src=./images/F5988C68A92AF7AC7F41464B2AF8BB08.gif></p><figure><figcaption class=image-caption>Le design initial est respecté, et les saccades ont disparu !</figcaption></figure><p><div class="details admonition comment open"><div class="details-summary admonition-title"><i class="icon fa-regular fa-comments fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>🐒‎ ‎ Parfait ! Mais je n’arrive pas à avancer, ni à reculer dans le morceau… là aussi, c’est un bug avec le <em>Slider</em> ?</div></div></div>Pas tout à fait. En fait, le <em>Slider</em> n’a pas encore été configuré pour cela, et c’est le but de la prochaine section !</p><h2 id=contrôler-la-tête-de-lecture>Contrôler la tête de lecture</h2><p>Pour contrôler la tête de lecture, l’utilisateur doit simplement glisser le curseur du <em>Slider</em> d’un point A à un point B. En décomposant un peu plus son geste, on pourrait dire que :</p><ol><li><p>L’utilisateur doit d’abord poser le doigt sur le curseur à un point A du <em>Slider</em>,</p></li><li><p>Puis il déplacera ce curseur en maintenant son doigt appuyé dessus,</p></li><li><p>Et enfin, il le relâchera à un point B du <em>Slider</em> en levant son doigt de l’écran.</p></li></ol><p>En lisant cette description, est-ce que ça t’a mis la puce à l’oreille ?</p><p><div class="details admonition comment open"><div class="details-summary admonition-title"><i class="icon fa-regular fa-comments fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>🐒‎ ‎ Je me rappelle qu’on avait mis en place des events pour détecter les gestes de l’utilisateur… c’est ça ?</div></div></div>Oui, bravo ! On aura ici besoin de deux évènements du <em>Slider</em> pour :</p><ul><li><p>Détecter le moment où l’utilisateur commence à déplacer le curseur,</p></li><li><p>Et détecter quand il le relâche.</p></li></ul><p>Rattachons ces deux évènements à notre <code>TimeTracker</code> depuis la méthode <em>InitTimeTracker()</em> :</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>void</span> <span class=n>InitTimeTracker</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>TimeTracker</span><span class=p>.</span><span class=n>DragStarted</span> <span class=p>+=</span> <span class=n>TimeTracker_DragStarted</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>TimeTracker</span><span class=p>.</span><span class=n>DragCompleted</span> <span class=p>+=</span> <span class=n>TimeTracker_DragCompleted</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-lightbulb fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>On aurait pu tout aussi bien utiliser les commandes fournies par le <em>Slider</em> et travailler depuis le <strong>ViewModel</strong>, mais on avait déjà expliqué <a href=../10-play-music-with-mediaelement/>ici</a> qu’il était préférable de garder la logique dans la <strong>View</strong> du fait que le <em>MediaElement</em> est un composant purement <a href=https://en.wikipedia.org/wiki/User_interface>UI</a>.</div></div></div><p align=center><img max-width=100% max-height=100% src=./images/734ED6F369BC98755C04A81669DBC22A.png></p><figure></figure><p>Maintenant, définis ces nouveaux évènements dans la région des <em>Events</em> avec le code suivant :</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=cp>#region</span> <span class=n>Events</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=k>void</span> <span class=n>TimeTracker_DragStarted</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>MusicPlayer</span><span class=p>.</span><span class=n>CurrentState</span> <span class=p>==</span> <span class=n>MediaElementState</span><span class=p>.</span><span class=n>Playing</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>mustResumePlayback</span> <span class=p>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		        <span class=n>MusicPlayer</span><span class=p>.</span><span class=n>Pause</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>void</span> <span class=n>TimeTracker_DragCompleted</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Il est recommandé de toujours se référer à l&#39;objet qui est</span>
</span></span><span class=line><span class=cl>        <span class=c1>// la source de l&#39;évènement à travers le paramètre &#34;sender&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>sender</span> <span class=k>is</span> <span class=n>Slider</span> <span class=n>timeTrackerControl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// On met à jour la position selon l&#39;endroit où l&#39;utilisateur</span>
</span></span><span class=line><span class=cl>            <span class=c1>// a arrêté son doigt</span>
</span></span><span class=line><span class=cl>            <span class=n>MusicPlayer</span><span class=p>.</span><span class=n>SeekTo</span><span class=p>(</span><span class=n>TimeSpan</span><span class=p>.</span><span class=n>FromSeconds</span><span class=p>(</span><span class=n>timeTrackerControl</span><span class=p>.</span><span class=n>Value</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>mustResumePlayback</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// La musique reprend si elle était jouée avant que</span>
</span></span><span class=line><span class=cl>                <span class=c1>// l&#39;utilisateur déplace le curseur</span>
</span></span><span class=line><span class=cl>                <span class=n>MusicPlayer</span><span class=p>.</span><span class=n>Play</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>mustResumePlayback</span> <span class=p>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>#endregion</span>
</span></span></code></pre></td></tr></table></div></div><p>Le premier évènement <em>TimeTracker_DragStarted()</em> correspond au moment où l’utilisateur commence à déplacer le curseur sur le <em>Slider</em>. Quand cela se produit, la lecture du morceau est mise en pause pour ne pas que la musique continue de jouer. Et d’ailleurs, le curseur continuerait de se déplacer tout seul !</p><p>Bien sûr, pour que l’expérience utilisateur soit bonne, il faut que la lecture du morceau reprenne aussitôt que l’utilisateur a terminé son mouvement. Pour cela, nous devons garder en mémoire le fait de devoir reprendre la lecture avec l’aide de la variable <code>mustResumePlayback</code>.</p><p><div class="details admonition comment open"><div class="details-summary admonition-title"><i class="icon fa-regular fa-comments fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>🐒‎ ‎ Mais d’où elle sort cette variable ? Jamais vue ! 😄</div></div></div>C’est normal, on va l’ajouter tout de suite ! Nous avons une nouvelle région dédiée en haut de la classe :</p><p align=center style=margin-bottom:-10px><strong>Nom du fichier :</strong><code>MusicPlayerView.cs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=cp>#region</span> <span class=n>Properties</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kt>bool</span> <span class=n>mustResumePlayback</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#endregion</span>
</span></span></code></pre></td></tr></table></div></div><p>Pour le second évènement <em>TimeTracker_DragCompleted()</em>, c’est le moment où l’utilisateur a fini de déplacer le curseur sur le <em>Slider</em>. Quand cela arrive, on repère la position du curseur pour alors réajuster la tête de lecture du <code>MusicPlayer</code> conformément. Pour cela, on a recours à la méthode <em>SeekTo()</em> exposée par la classe du <em>MediaElement</em>, avec un temps de référence pour paramètre (au format <em>TimeSpan</em>).</p><p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fa-solid fa-info-circle fa-fw" aria-hidden=true></i>‎<i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Cela aura un effet immédiat sur la valeur sur la propriété <code>MusicPlayer.Position</code>.</div></div></div>Enfin, la lecture du morceau reprendra aussitôt après, à partir de la nouvelle position choisie.</p><p>Relance le projet et vérifie que tu peux avancer ou reculer dans le morceau !</p><p align=center><img max-width=100% max-height=100% src=./images/B3744B2F4976B3ADEB7CF5C498642C70.gif></p><figure><figcaption class=image-caption>Et hop, je reviens au tout début du morceau !</figcaption></figure><p>Tu viens de terminer l’implémentation d’une belle fonctionnalité pour l’utilisateur, bravo !</p><p><a href=../12-control-volume-with-mediaelement/>La prochaine fois</a>, nous verrons comment implémenter la gestion du volume. À très vite !</p><hr><p>Plus d&rsquo;articles dans la même série:<ol><div><li hugo-nav=/posts/tutos/my-first-app/1-introduction/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/1-introduction/>Ma toute première app en .NET MAUI</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/2-setup-the-project/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/2-setup-the-project/>Installation du projet .NET MAUI</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/3-first-run-of-the-project/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/3-first-run-of-the-project/>Première exécution de l’app .NET MAUI</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/4-mvvm-for-successful-apps/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/4-mvvm-for-successful-apps/>Le MVVM, pour une application réussie</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/5-navigate-to-a-new-page/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/5-navigate-to-a-new-page/>Naviguer vers une nouvelle page en .NET MAUI</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/6-arrange-elements-on-a-page/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/6-arrange-elements-on-a-page/>Agencer les éléments d'une page .NET MAUI</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/7-music-player-display-time-tracker/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/7-music-player-display-time-tracker/>Affichage du lecteur MP3 - Durée d'écoute</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/8-music-player-display-media-playback/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/8-music-player-display-media-playback/>Affichage du lecteur MP3 - Contrôles de lecture</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/9-music-player-display-volume/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/9-music-player-display-volume/>Affichage du lecteur MP3 - Volume</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/10-play-music-with-mediaelement/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/10-play-music-with-mediaelement/>Écouter de la musique en .NET MAUI avec MediaElement</a></li></div><div class=current><li hugo-nav=/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/ class=nostyle><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/>Contrôler la tête de lecture avec MediaElement</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/12-control-volume-with-mediaelement/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/12-control-volume-with-mediaelement/>Contrôler le volume avec MediaElement</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/13-download-audio-file/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/13-download-audio-file/>Télécharger un fichier audio en .NET MAUI</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/14-skip-next-or-previous-with-mediaelement/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/14-skip-next-or-previous-with-mediaelement/>Écouter une playlist avec MediaElement</a></li></div><div><li hugo-nav=/posts/tutos/my-first-app/15-add-animations-to-an-app/><a href=https://www.mauicestclair.fr/posts/tutos/my-first-app/15-add-animations-to-an-app/>Créer des animations avec .NET MAUI pour une ambiance disco</a></li></div></ol></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Mis à jour le 2023-12-01 00:00:11">Mis à jour le 01/12/2023&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Partager via Twitter" data-sharer=twitter data-url=https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/ data-title="Contrôler la tête de lecture avec MediaElement" data-via=kapuschinfo data-hashtags="MVVM,Data Binding,MediaElement,Slider"><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Partager via Facebook" data-sharer=facebook data-url=https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/ data-hashtag=MVVM><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Partager via Linkedin" data-sharer=linkedin data-url=https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Partager via Blogger" data-sharer=blogger data-url=https://www.mauicestclair.fr/posts/tutos/my-first-app/11-control-playback-position-with-mediaelement/ data-title="Contrôler la tête de lecture avec MediaElement" data-description="Continuons sur notre lancée avec l’implémentation du contrôle de la tête de lecture ! L’idée est de pouvoir se déplacer à un endroit précis du morceau."><i class="fa-brands fa-blogger fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/mvvm/ class=post-tag>MVVM</a><a href=/tags/data-binding/ class=post-tag>Data Binding</a><a href=/tags/mediaelement/ class=post-tag>MediaElement</a><a href=/tags/slider/ class=post-tag>Slider</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Retour</a></span>&nbsp;|&nbsp;<span><a href=/>Accueil</a></span></section></div><div class=post-nav><a href=/posts/tutos/my-first-app/10-play-music-with-mediaelement/ class=post-nav-item rel=prev title="Écouter de la musique en .NET MAUI avec MediaElement"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Écouter de la musique en .NET MAUI avec MediaElement</a>
<a href=/posts/tutos/my-first-app/12-control-volume-with-mediaelement/ class=post-nav-item rel=next title="Contrôler le volume avec MediaElement">Contrôler le volume avec MediaElement<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=giscus><script src=https://giscus.app/client.js data-repo=Kapusch/blog-dotnet-maui data-repo-id=R_kgDOH_4TbQ data-category="Blog comments" data-category-id=DIC_kwDOH_4Tbc4CSqsZ data-mapping=Title data-strict=0 data-theme=preferred_color_scheme data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-lang=fr crossorigin=anonymous async defer></script></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/ rel="external nofollow noopener noreferrer">giscus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line custom"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></div><div class="footer-line powered">Propulsé par <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.123.0">Hugo</a> | Thème - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=https://github.com/Kapusch target=_blank rel="external nofollow noopener noreferrer">Jean-Emmanuel BAILLAT</a></span><span class="license footer-divider"><u><a rel="license external nofollow noopener noreferrer" href=/privacy-policy target=_blank>Confidentialité</a></u> et <u><a rel="license external nofollow noopener noreferrer" href=/terms-of-use target=_blank>CGU</a></u></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Retour en Haut"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label="Afficher les Commentaires"><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><a href=https://github.com/Kapusch/blog-dotnet-maui/tree/main/Blog title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner left d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><noscript><div class=noscript-warning>Le thème FixIt fonctionne mieux quand JavaScript est activé.</div></noscript></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/lunr/lunr.min.js defer></script><script src=/lib/lunr/lunr.stemmer.support.min.js defer></script><script src=/lib/lunr/lunr.fr.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/katex/katex.min.js defer></script><script src=/lib/katex/auto-render.min.js defer></script><script src=/lib/katex/copy-tex.min.js defer></script><script src=/lib/katex/mhchem.min.js defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script>window.config={code:{copyTitle:"Copier dans le presse-papiers",maxShownLines:50},comment:{enable:!0,expired:!1,giscus:{darkTheme:"dark_dimmed",lightTheme:"light"}},cookieconsent:{content:{dismiss:"J'ai compris !",link:"En apprendre plus",message:"Ce site Web utilise des Cookies pour améliorer votre expérience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"fr",maxResultLength:10,noResultsFound:"Aucun résultat trouvé",snippetLength:110,type:"lunr"}}</script><script src=/js/theme.min.js defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0BB9XCL25S",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=G-0BB9XCL25S" async></script></body></html>